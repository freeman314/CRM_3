# Полная документация CRM-проекта

## 1. Обзор проекта

Данный проект представляет собой систему управления взаимоотношениями с клиентами (CRM) для малого и среднего бизнеса. Система разработана с использованием стека технологий MERN (MongoDB, Express, React, Node.js) и предоставляет функционал для управления клиентской базой, включая отслеживание статусов клиентов, историю взаимодействий и управление задачами.

### 1.1 Основные возможности

- Добавление и управление данными клиентов
- Отслеживание статусов клиентов и дат окончания контрактов
- Управление задачами и напоминаниями
- История звонков и взаимодействий с клиентами
- Система ролей пользователей (менеджер, главный менеджер, администратор)
- Аналитика и отчетность
- Управление справочниками системы

### 1.2 Технологический стек

- Backend: Node.js с Express.js
- Frontend: React.js
- База данных: MongoDB или PostgreSQL
- Аутентификация: JSON Web Tokens (JWT)
- Веб-сервер: Nginx (для обратного прокси и балансировки нагрузки)

## 2. Архитектура проекта

Проект следует архитектуре MVC (Model-View-Controller) и состоит из следующих основных компонентов:

### 2.1 Серверная часть (Backend)

- `index.js`: Точка входа в приложение, настройка сервера Express
- `db.js`: Конфигурация подключения к базе данных
- `routes/`: Директория с файлами маршрутизации
  - `clientRoutes.js`: Обработка запросов, связанных с клиентами
  - `clientStatusRoutes.js`: Обработка запросов, связанных со статусами клиентов
  - `userRoutes.js`: Обработка запросов, связанных с пользователями системы
  - `taskRoutes.js`: Обработка запросов, связанных с задачами
  - `callRoutes.js`: Обработка запросов, связанных с звонками
- `models/`: Директория с моделями данных
  - `client.js`: Модель данных клиента
  - `clientStatus.js`: Модель данных статуса клиента
  - `user.js`: Модель данных пользователя
  - `task.js`: Модель данных задачи
  - `call.js`: Модель данных звонка
- `controllers/`: Директория с контроллерами
  - `clientController.js`: Логика обработки запросов для клиентов
  - `userController.js`: Логика обработки запросов для пользователей
  - `taskController.js`: Логика обработки запросов для задач
  - `callController.js`: Логика обработки запросов для звонков
- `middlewares/`: Директория с промежуточными обработчиками
  - `auth.js`: Middleware для аутентификации и авторизации
- `utils/`: Директория с вспомогательными функциями

### 2.2 Клиентская часть (Frontend)

- `src/`
  - `components/`: Многоразовые компоненты React
  - `pages/`: Компоненты страниц
  - `services/`: Сервисы для работы с API
  - `context/`: Контексты React для управления состоянием
  - `hooks/`: Пользовательские хуки
  - `utils/`: Вспомогательные функции
  - `styles/`: Стили CSS или SCSS
  - `App.js`: Основной компонент приложения
  - `index.js`: Точка входа для React приложения

### 2.3 Вспомогательные скрипты

- `initClientStatuses.js`: Скрипт для инициализации базовых статусов клиентов в базе данных

## 3. Модели данных

### 3.1 Клиент (Client)

```javascript
{
  id: ObjectId,
  firstName: String,
  lastName: String,
  email: String,
  phone: String,
  address: String,
  city: { type: ObjectId, ref: 'City' },
  currentProvider: String,
  contractEndDate: Date,
  notes: String,
  status: { type: ObjectId, ref: 'ClientStatus' },
  category: { type: ObjectId, ref: 'Category' },
  potential: String,
  assignedManager: { type: ObjectId, ref: 'User' },
  createdAt: Date,
  updatedAt: Date
}
```

### 3.2 Статус клиента (ClientStatus)

```javascript
{
  id: ObjectId,
  name: String,
  description: String
}
```

### 3.3 Категория клиента (Category)

```javascript
{
  id: ObjectId,
  name: String,
  description: String
}
```

### 3.4 Город (City)

```javascript
{
  id: ObjectId,
  name: String,
  region: String
}
```

### 3.5 Пользователь (User)

```javascript
{
  id: ObjectId,
  username: String,
  email: String,
  passwordHash: String,
  role: { type: String, enum: ['manager', 'chief_manager', 'admin'] },
  createdAt: Date,
  updatedAt: Date
}
```

### 3.6 Задача (Task)

```javascript
{
  id: ObjectId,
  title: String,
  description: String,
  client: { type: ObjectId, ref: 'Client' },
  assignedTo: { type: ObjectId, ref: 'User' },
  status: { type: String, enum: ['new', 'in_progress', 'completed'] },
  dueDate: Date,
  createdAt: Date,
  updatedAt: Date
}
```

### 3.7 Звонок (Call)

```javascript
{
  id: ObjectId,
  client: { type: ObjectId, ref: 'Client' },
  manager: { type: ObjectId, ref: 'User' },
  dateTime: Date,
  result: { type: String, enum: ['successful', 'no_answer', 'rescheduled'] },
  comment: String,
  newStatus: { type: ObjectId, ref: 'ClientStatus' },
  newPotential: String
}
```

## 4. API Endpoints

### 4.1 Клиенты

- `GET /api/clients`: Получить список всех клиентов
- `POST /api/clients`: Создать нового клиента
- `GET /api/clients/:id`: Получить информацию о конкретном клиенте
- `PUT /api/clients/:id`: Обновить информацию о клиенте
- `DELETE /api/clients/:id`: Удалить клиента

### 4.2 Статусы клиентов

- `GET /api/client-statuses`: Получить список всех статусов клиентов
- `POST /api/client-statuses`: Создать новый статус клиента
- `GET /api/client-statuses/:id`: Получить информацию о конкретном статусе
- `PUT /api/client-statuses/:id`: Обновить информацию о статусе
- `DELETE /api/client-statuses/:id`: Удалить статус

### 4.3 Пользователи

- `POST /api/users/register`: Регистрация нового пользователя
- `POST /api/users/login`: Аутентификация пользователя
- `GET /api/users/profile`: Получить профиль текущего пользователя
- `PUT /api/users/profile`: Обновить профиль текущего пользователя
- `GET /api/users`: Получить список всех пользователей (только для админа)
- `PUT /api/users/:id`: Обновить информацию о пользователе (только для админа)
- `DELETE /api/users/:id`: Удалить пользователя (только для админа)

### 4.4 Задачи

- `GET /api/tasks`: Получить список задач
- `POST /api/tasks`: Создать новую задачу
- `GET /api/tasks/:id`: Получить информацию о конкретной задаче
- `PUT /api/tasks/:id`: Обновить информацию о задаче
- `DELETE /api/tasks/:id`: Удалить задачу

### 4.5 Звонки

- `GET /api/calls`: Получить список звонков
- `POST /api/calls`: Создать новую запись о звонке
- `GET /api/calls/:id`: Получить информацию о конкретном звонке
- `PUT /api/calls/:id`: Обновить информацию о звонке
- `DELETE /api/calls/:id`: Удалить запись о звонке

## 5. Функциональность клиентской части

### 5.1 Основные функции

- Отображение списка клиентов с возможностью фильтрации и сортировки
- Форма добавления нового клиента
- Форма редактирования информации о клиенте
- Отображение истории взаимодействий с клиентом (звонки, задачи)
- Форма быстрого звонка и обработки информации
- Дашборд с ключевыми показателями и списком ближайших задач
- Календарь с отображением дат окончания контрактов и запланированных задач
- Система уведомлений о приближающихся дедлайнах и важных событиях
- Генерация отчетов

### 5.2 Взаимодействие с сервером

Клиентская часть использует Fetch API или Axios для отправки запросов на сервер и получения данных.

## 6. Структура пользовательского интерфейса

### 6.1 Общая структура

- Главное меню (навигационная панель)
- Рабочая область
- Панель уведомлений

### 6.2 Страницы и разделы

1. Страница входа
   - Форма входа
   - Восстановление пароля

2. Дашборд (главная страница после входа)
   - Ключевые показатели
   - Быстрые ссылки на основные разделы
   - Список задач/напоминаний

3. Список клиентов
   - Таблица с клиентами
   - Фильтры и поиск
   - Преднастроенные фильтры по датам окончания контрактов

4. Страница клиента
   - Основная информация
   - История изменений
   - Прикрепленные документы
   - История звонков
   - Список задач, связанных с клиентом

5. Форма добавления/редактирования клиента

6. Календарь
   - Отображение дат окончания контрактов
   - Запланированные задачи

7. Отчеты
   - Выбор типа отчета
   - Настройка параметров
   - Предпросмотр и экспорт

8. Справочники
   - Список справочников
   - Редактирование записей в справочниках

9. Настройки пользователя
   - Изменение пароля
   - Настройка уведомлений

10. Административная панель
    - Управление пользователями
    - Настройки системы
    - Журнал действий пользователей

### 6.3 Дополнительные элементы интерфейса

- Модальные окна для быстрых действий (например, добавление заметки)
- Всплывающие уведомления
- Подсказки и обучающие элементы для новых пользователей

## 7. Прототипы интерфейса

### 7.1 Главная страница (Дашборд)

```
+-----------------------------------------------------+
|  Логотип   Клиенты   Задачи   Отчеты   Профиль     |
+-----------------------------------------------------+
|                                                     |
|  +-------------------+  +------------------------+  |
|  | Статистика         |  | Ближайшие дедлайны     |  |
|  | - Всего клиентов   |  | - Истекает через 2 нед |  |
|  | - Активные         |    (15) [Просмотр >>]     |  |
|  | - Потенциальные    |  | - Истекает через 1 мес |  |
|  +-------------------+    (30) [Просмотр >>]     |  |
|                         +------------------------+  |
|  +-------------------+  +------------------------+  |
|  | Последние действия |  | Быстрые действия       |  |
|  | - Добавлен клиент  |  | [Добавить клиента]     |  |
|  | - Обновлен статус  |  | [Создать задачу]       |  |
|  | - Создана задача   |  | [Сформировать отчет]   |  |
|  +-------------------+  +------------------------+  |
|                                                     |
+-----------------------------------------------------+
```

### 7.2 Список клиентов

```
+-----------------------------------------------------+
|  Логотип   Клиенты   Задачи   Отчеты   Профиль     |
+-----------------------------------------------------+
| Поиск: [                    ]  [Фильтры v]          |
+-----------------------------------------------------+
| Имя    | Телефон   | Статус  | Дедлайн   | Действия |
+-----------------------------------------------------+
| Иван П.| +7 (123)..| Активный| 15.06.2023| [Звонок] |
|        |           |         |           | [Ред.  ] |
+-----------------------------------------------------+
| Анна С.| +7 (456)..| Новый   | 20.06.2023| [Звонок] |
|        |           |         |           | [Ред.  ] |
+-----------------------------------------------------+
| Петр К.| +7 (789)..| Ожидание| 01.07.2023| [Звонок] |
|        |           |         |           | [Ред.  ] |
+-----------------------------------------------------+
|                                                     |
|  [< Пред]  Страница 1 из 10  [След >]               |
+-----------------------------------------------------+
```

### 7.3 Страница клиента

```
+-----------------------------------------------------+
|  Логотип   Клиенты > Иван Петров                    |
+-----------------------------------------------------+
|                                                     |
|  Имя: Иван Петров                                   |
|  Email: ivan@example.com                            |
|  Телефон: +7 (123) 456-78-90                        |
|  Адрес: ул. Примерная, д. 1, кв. 1                  |
|  Статус: Активный                                   |
|  Категория: Частный дом                             |
|                                                     |
|  +-------------------+  +------------------------+  |
|  | История изменений  |  | Документы              |  |
|  | - 01.05: Изменен...| | - Договор.pdf           |  |
|  | - 28.04: Добавлен  | | [Загрузить документ]    |  |
|  +-------------------+  +------------------------+  |
|                                                     |
|  +-------------------+  +------------------------+  |
|  | Заметки            |  | Задачи                 |  |
|  | - Перезвонить в... | | - Отправить КП          |  |
|  | [Добавить заметку] | | [Создать задачу]        |  |
|  +-------------------+  +------------------------+  |
|                                                     |
|  [Редактировать]        [Удалить]                   |
+-----------------------------------------------------+
```

### 7.4 Форма быстрого звонка и обработки информации

```
+-----------------------------------------------------+
|  Логотип   Клиенты > Иван Петров > Новый звонок     |
+-----------------------------------------------------+
|  Имя: Иван Петров                                   |
|  Телефон: +7 (123) 456-78-90                        |
|  Текущий статус: [Текущий статус клиента]           |
|  Дата окончания контракта: 15.06.2023               |
+-----------------------------------------------------+
|  История звонков:                                   |
|  [Таблица с последними 3-5 звонками]                |
+-----------------------------------------------------+
|  Результат текущего звонка:                         |
|  ( ) Успешно связались                              |
|  ( ) Не дозвонились                                 |
|  ( ) Перенесли на другое время                      |
+-----------------------------------------------------+
|  Новый статус: [Выбрать из справочника v]           |
|  Оценка потенциала: [Выбрать из справочника v]      |
|  Комментарий: [                                  ]  |
|                                                     |
|  Следующее действие:                                |
|  [ ] Создать задачу                                 |
|  [ ] Запланировать следующий звонок                 |
|                                                     |
|  [Сохранить и закрыть]  [Отмена]                    |
+-----------------------------------------------------+
```

### 7.5 Страница истории звонков клиента

```
+-----------------------------------------------------+
|  Логотип   Клиенты > Иван Петров > История звонков  |
+-----------------------------------------------------+
|  Имя: Иван Петров                                   |
|  Телефон: +7 (123) 456-78-90                        |
+-----------------------------------------------------+
|  Дата    | Менеджер | Результат | Статус | Действия |
+-----------------------------------------------------+
| 20.05.23 | Анна И.  | Успешно   | Активен| [Подробно]|
| 15.05.23 | Петр С.  | Не дозвон.| Новый  | [Подробно]|
| 10.05.23 | Анна И.  | Перенесен | Новый  | [Подробно]|
+-----------------------------------------------------+
|  [< Пред]  Страница 1 из 3  [След >]                |
|                                                     |
|  [Новый звонок]  [Назад к профилю клиента]          |
+-----------------------------------------------------+
```

## 8. Описание бизнес-процессов

### 8.1 Процесс обработки нового клиента

1. Получение контакта потенциального клиента
2. Создание карточки клиента в CRM
   - Заполнение основной информации
   - Выбор населенного пункта из справочника (или добавление нового)
   - Назначение категории (тип домохозяйства)
   - Установка начального статуса
   - Оценка потенциала клиента
3. Назначение ответственного менеджера
4. Первичный контакт с клиентом
5. Обновление статуса и добавление заметок
6. Отправка коммерческого предложения
7. Последующие переговоры и уточнение деталей
8. Заключение договора или обновление статуса
9. Загрузка подписанных документов
10. Установка даты окончания контракта и планирование следующего контакта

### 8.2 Процесс обработки клиентов с приближающимся дедлайном

1. Система ежедневно проверяет даты окончания контрактов
2. Клиенты группируются по срокам до истечения контракта (2 недели, 1 месяц и т.д.)
3. На дашборде отображаются группы клиентов с количеством
4. Менеджер переходит к списку клиентов конкретной группы
5. Менеджер выбирает клиента для обработки
6. Открывается форма быстрого звонка
7. Менеджер совершает звонок и фиксирует результат
8. В зависимости от результата, менеджер обновляет статус и планирует следующие действия
9. Система обновляет информацию о клиенте и, при необходимости, создает новую задачу

### 8.3 Процесс совершения звонка клиенту

1. Менеджер выбирает клиента для звонка
2. Открывается форма нового звонка с историей предыдущих звонков
3. Менеджер совершает звонок
4. Менеджер фиксирует результат звонка в системе
5. При необходимости обновляется статус и оценка потенциала клиента
6. Менеджер добавляет комментарий и планирует следующие действия
7. Информация о звонке сохраняется в истории звонков клиента
8. Если запланированы дальнейшие действия, создается соответствующая задача

## 9. Требования к развертыванию системы

### 9.1 Требования к развертыванию
- Возможность развертывания на корпоративном сервере
- Доступ для сотрудников с рабочих компьютеров через веб-браузер
- Поддержка одновременной работы множества пользователей

### 9.2 Требования к серверу
- Операционная система: Linux (предпочтительно Ubuntu Server)
- Минимальные требования к оборудованию: [будет определено после тестирования производительности]

## 10. Управление пользователями системы

### 10.1 Роли пользователей
- Администратор системы
- Главный менеджер
- Менеджер

### 10.2 Функциональность администратора
- Интерфейс управления пользователями:
  - Добавление новых менеджеров
  - Установка начальных паролей
  - Назначение ролей
  - Деактивация учетных записей
  - Сброс паролей
- Просмотр журнала действий пользователей

### 10.3 Безопасность учетных записей
- Обязательная смена пароля при первом входе
- Требования к сложности пароля (минимальная длина, использование букв, цифр и специальных символов)
- Возможность двухфакторной аутентификации (опционально)

### 10.4 Управление сессиями
- Автоматический выход из системы после определенного периода неактивности
- Возможность одновременного входа с нескольких устройств (настраивается администратором)

## 11. Интеграция и расширяемость

### 11.1 API
- Разработка RESTful API для возможности интеграции с другими системами в будущем

### 11.2 Модульная архитектура
- Проектирование системы с учетом возможности добавления новых модулей в будущем

## 12. Тестирование

### 12.1 Виды тестирования
- Модульное тестирование
- Интеграционное тестирование
- Тестирование пользовательского интерфейса
- Нагрузочное тестирование

### 12.2 Тестовые сценарии
- Разработка основных тестовых сценариев для ключевых функций системы

## 13. Документация

### 13.1 Пользовательская документация
- Руководство пользователя
- Руководство администратора

### 13.2 Техническая документация
- Документация по API
- Руководство по развертыванию системы

## 14. План разработки

### 14.1 Этапы разработки

1. Проектирование базы данных и API (2 недели)
2. Разработка базового функционала backend (4 недели)
   - Аутентификация и авторизация
   - CRUD операции для клиентов
   - Управление задачами и заметками
3. Разработка пользовательского интерфейса (6 недель)
   - Реализация основных страниц
   - Интеграция с API
4. Реализация дополнительных функций (3 недели)
   - Система уведомлений
   - Отчеты и аналитика
5. Тестирование и отладка (3 недели)
6. Развертывание и настройка сервера (1 неделя)
7. Подготовка документации и обучение пользователей (2 недели)

Общая предварительная оценка времени разработки: 21 неделя

### 14.2 Приоритеты разработки

1. Критически важные функции:
   - Управление клиентами
   - Аутентификация и авторизация
   - Базовый пользовательский интерфейс

2. Важные функции:
   - Управление задачами и заметками
   - Отчеты и аналитика
   - Расширенные функции пользовательского интерфейса

3. Желательные функции:
   - Система уведомлений
   - Расширенная аналитика
   - Интеграция с внешними системами

## 15. Заключение

Данный CRM-проект предоставляет комплексное решение для управления взаимоотношениями с клиентами, ориентированное на потребности малого и среднего бизнеса. Система обеспечивает эффективное управление клиентской базой, отслеживание взаимодействий, управление задачами и аналитику. 

Модульная архитектура и наличие API позволяют расширять функциональность системы в будущем. Особое внимание уделено удобству использования для менеджеров и безопасности данных.

Реализация проекта согласно данной документации позволит создать надежную и эффективную CRM-систему, которая может быть адаптирована под конкретные бизнес-требования и масштабирована по мере роста компании.